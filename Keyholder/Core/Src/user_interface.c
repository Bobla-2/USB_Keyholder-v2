#include "user_interface.h"
#include "ssd1306.h"
#include "stdio.h"
#include "main.h"

#include "usbd_cdc_if.h"

#define DEBUG

const unsigned char imgN1[] = {
	0xc1, 0x8f, 0x87, 0xf8, 0xc1, 0x9f, 0xc7, 0xfc, 0xc1, 0x98, 0x06, 0x0c, 0xc1, 0x98, 0x06, 0x0c, 
	0xc1, 0x98, 0x06, 0x0c, 0xc1, 0x9f, 0x87, 0xf8, 0xc1, 0x8f, 0xc7, 0xf8, 0xc1, 0x80, 0xc6, 0x0c, 
	0xc1, 0x80, 0xc6, 0x0c, 0xe3, 0x80, 0xc6, 0x0c, 0x7f, 0x1f, 0xc7, 0xfc, 0x3e, 0x0f, 0x87, 0xf8, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x70, 0x00, 0x00, 0x00, 0x20, 0xff, 0xff, 0xff, 0xfc, 
	0x80, 0x00, 0x00, 0x24, 0x80, 0x00, 0x00, 0x24, 0xa4, 0xa4, 0xa4, 0xa4, 0x95, 0x15, 0x15, 0x24, 
	0x8e, 0x0e, 0x0e, 0x24, 0x8e, 0x0e, 0x0e, 0x24, 0x95, 0x15, 0x15, 0x24, 0xa4, 0xa4, 0xa4, 0xa4, 
	0x80, 0x00, 0x00, 0x24, 0x80, 0x00, 0x00, 0x24, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x00, 0x00, 0x20, 
	0x00, 0x00, 0x00, 0x70, 0x00, 0x00, 0x00, 0x00
};
const unsigned char imgN2[] = {
	0xc1, 0x80, 0x07, 0xf8, 0xc1, 0x87, 0x87, 0xfc, 0xc1, 0x8c, 0x86, 0x0c, 0xc1, 0x98, 0x86, 0x0c, 
	0xc1, 0x80, 0x86, 0x0c, 0xc1, 0x80, 0x87, 0xf8, 0xc1, 0x81, 0x07, 0xf8, 0xc1, 0x82, 0x06, 0x0c, 
	0xc1, 0x86, 0x06, 0x0c, 0xe3, 0x8c, 0x06, 0x0c, 0x7f, 0x0f, 0xc7, 0xfc, 0x3e, 0x00, 0x07, 0xf8, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x70, 0x00, 0x00, 0x00, 0x20, 0xff, 0xff, 0xff, 0xfc, 
	0x80, 0x00, 0x00, 0x24, 0x80, 0x00, 0x00, 0x24, 0xa4, 0xa4, 0xa4, 0xa4, 0x95, 0x15, 0x15, 0x24, 
	0x8e, 0x0e, 0x0e, 0x24, 0x8e, 0x0e, 0x0e, 0x24, 0x95, 0x15, 0x15, 0x24, 0xa4, 0xa4, 0xa4, 0xa4, 
	0x80, 0x00, 0x00, 0x24, 0x80, 0x00, 0x00, 0x24, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x00, 0x00, 0x20, 
	0x00, 0x00, 0x00, 0x70, 0x00, 0x00, 0x00, 0x00
};
const unsigned char imgN3[] = {
	0xc1, 0x80, 0x07, 0xf8, 0xc1, 0x80, 0x07, 0xfc, 0xc1, 0x8f, 0x86, 0x0c, 0xc1, 0x98, 0x86, 0x0c, 
	0xc1, 0x80, 0x86, 0x0c, 0xc1, 0x87, 0x87, 0xf8, 0xc1, 0x87, 0x87, 0xf8, 0xc1, 0x80, 0x86, 0x0c, 
	0xc1, 0x80, 0x86, 0x0c, 0xe3, 0x80, 0x86, 0x0c, 0x7f, 0x01, 0x87, 0xfc, 0x3e, 0x3f, 0x07, 0xf8, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x70, 0x00, 0x00, 0x00, 0x20, 0xff, 0xff, 0xff, 0xfc, 
	0x80, 0x00, 0x00, 0x24, 0x80, 0x00, 0x00, 0x24, 0xa4, 0xa4, 0xa4, 0xa4, 0x95, 0x15, 0x15, 0x24, 
	0x8e, 0x0e, 0x0e, 0x24, 0x8e, 0x0e, 0x0e, 0x24, 0x95, 0x15, 0x15, 0x24, 0xa4, 0xa4, 0xa4, 0xa4, 
	0x80, 0x00, 0x00, 0x24, 0x80, 0x00, 0x00, 0x24, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x00, 0x00, 0x20, 
	0x00, 0x00, 0x00, 0x70, 0x00, 0x00, 0x00, 0x00
};
const unsigned char imgN4[] = {
  0xc1, 0x80, 0x07, 0xf8, 0xc1, 0x84, 0x47, 0xfc, 0xc1, 0x88, 0x46, 0x0c, 0xc1, 0x88, 0x46, 0x0c, 
	0xc1, 0x88, 0xc6, 0x0c, 0xc1, 0x8d, 0xc7, 0xf8, 0xc1, 0x87, 0x87, 0xf8, 0xc1, 0x80, 0x86, 0x0c, 
	0xc1, 0x80, 0x86, 0x0c, 0xe3, 0x80, 0x86, 0x0c, 0x7f, 0x01, 0x07, 0xfc, 0x3e, 0x01, 0x07, 0xf8, 
	0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x70, 0x00, 0x00, 0x00, 0x20, 0xff, 0xff, 0xff, 0xfc, 
	0x80, 0x00, 0x00, 0x24, 0x80, 0x00, 0x00, 0x24, 0xa4, 0xa4, 0xa4, 0xa4, 0x95, 0x15, 0x15, 0x24, 
	0x8e, 0x0e, 0x0e, 0x24, 0x8e, 0x0e, 0x0e, 0x24, 0x95, 0x15, 0x15, 0x24, 0xa4, 0xa4, 0xa4, 0xa4, 
	0x80, 0x00, 0x00, 0x24, 0x80, 0x00, 0x00, 0x24, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x00, 0x00, 0x20, 
	0x00, 0x00, 0x00, 0x70, 0x00, 0x00, 0x00, 0x00
};

const int menuItemsCount = 4;

char passTrue[6] = "111111";
char pass[6];
void PAS_print_menu( void ){
	
	#ifndef DEBUG
	ssd1306_Fill(Black);
	ssd1306_DrawRectangle(0, 0, 127, 31, White);
	
	for (int j = 0; j < 6; j++){
		while(!switches_byte)
			HAL_Delay(1);
		
		ssd1306_SetCursor(2 + 16 * j, 2);
		for(int i = 0; i < 8; i++){
			if(switches_byte & (1 << i)){		
				pass[j] = i + '1';	
				ssd1306_WriteChar(i + '1', Font_16x26, White);
				break;
			}
		}
		
		for(int i = 0; i < j; i++){
			ssd1306_SetCursor(2 + 16 * i, 2);		
			ssd1306_WriteChar('*', Font_16x26, White);
		}
		
		ssd1306_UpdateScreen(); 
		
		while(switches_byte)
			HAL_Delay(1);
	}
	int unPass = 0;
	for (int i = 0; i < 6; i++){
		if (pass[i] == passTrue[i]){
			unPass++;
		}
	}
	if (unPass == 6)
		tPass = 1;
	#else
	tPass = 1;
	#endif
}

int cycleFlag = 0;
int numMenuItem = 0;
char masMenuItem[15] = "ABCDFGSUS";
void UI_print_menu( void ){
	
	ssd1306_Fill(Black);
	if (cycleFlag == 0){
		ssd1306_DrawBitmap(34, 0, imgN1,  30, 30, White);
		ssd1306_DrawBitmap(68, 0, imgN2,  30, 30, White);
		ssd1306_UpdateScreen();
		cycleFlag = 1;
	}
	int pushedButtonNumber = 0;
	ssd1306_Fill(Black);
	
	while(!switches_byte)
		HAL_Delay(1);
	
	for(int i = 0; i < 8; i++){
		if(switches_byte & (1 << i)){			
				pushedButtonNumber = i ;
				break;
		}
	}
	if(pushedButtonNumber == 0)
			numMenuItem--;
	else if(pushedButtonNumber == 1)
			numMenuItem++;
		
	
	ssd1306_Line(36, 31, 68, 31, White);
	ssd1306_Line(46, 31, 58, 31, White);
	
	switch (numMenuItem){
		case -2:
			numMenuItem = 3;
			ssd1306_DrawBitmap(0, 0, imgN3,  30, 30, White);
			ssd1306_UpdateScreen();
		break;
		case -1:
			ssd1306_DrawBitmap(68, 0, imgN1,  30, 30, White);
			ssd1306_UpdateScreen();
		break;
		case 0:
			ssd1306_DrawBitmap(34, 0, imgN1,  30, 30, White);
			ssd1306_DrawBitmap(68, 0, imgN2,  30, 30, White);
			ssd1306_UpdateScreen();
			break;
		case 1:
			ssd1306_DrawBitmap(0, 0, imgN1,  30, 30, White);
			ssd1306_DrawBitmap(34, 0, imgN2,  30, 30, White);
			ssd1306_DrawBitmap(68, 0, imgN3,  30, 30, White);
			ssd1306_UpdateScreen();
			break;
		case 2:
			ssd1306_DrawBitmap(0, 0, imgN2,  30, 30, White);
			ssd1306_DrawBitmap(34, 0, imgN3,  30, 30, White);
			ssd1306_UpdateScreen();
			break;
		case 3:
			ssd1306_DrawBitmap(0, 0, imgN3,  30, 30, White);
			ssd1306_UpdateScreen();
			break;
		case 4:
			numMenuItem = -1;
			ssd1306_DrawBitmap(68, 0, imgN1,  30, 30, White);
			ssd1306_UpdateScreen();
			break;
		}

	
	
/*	if(numMenuItem == menuItemsCount + 1){			
			numMenuItem = 0;		
	}
	else if(numMenuItem == 0){			
			numMenuItem = menuItemsCount-1;		
	}
	
	ssd1306_DrawBitmap(((numMenuItem - 1)* 34 + 4), 0, imgN1,  30, 30, White);
	ssd1306_DrawBitmap((numMenuItem * 34) + 4, 0, imgN2,  30, 30, White);
	if(numMenuItem != (menuItemsCount+1))
	ssd1306_DrawBitmap(((numMenuItem + 1) * 34 + 4), 0, imgN3,  30, 30, White);
	ssd1306_Line(36, 31, 68, 31, White);
	ssd1306_UpdateScreen();
	*/
	while(switches_byte)
			HAL_Delay(1);
	
	
}
